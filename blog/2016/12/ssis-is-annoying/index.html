<!DOCTYPE html><html lang="en"><head><title>SSIS Is Annoying - Steven J Hicks</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" href="/static/css/site.css"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css"></head><body><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-75007713-1', 'auto');
ga('send', 'pageview');</script><nav class="navbar navbar-inverse navbar-fat navbar-default navbar-static-top"><div class="container-fluid"><div class="navbar-header"><a href="/" class="navbar-brand">Steven J Hicks</a><a href="/about" class="navbar-brand">About</a></div></div></nav><div class="container"><h1>SSIS Is Annoying</h1><div class="timestamp">December 1, 2016</div><article><p>The project I&#39;m currently working on requires a spreadsheet to be imported into the database. SSIS seemed like the logical solution to this.</p>
<p>But one month after dealing with SSIS, I am done with it. SSIS is like 85% awesome - but 15% &quot;OMG I hate you&quot;. <a href="https://www.youtube.com/watch?v=QfzDUpB88x4&amp;t=0m24s">I wrote a song about it, like to hear it here it goes</a>.</p>
<h3 id="ssis-doesn-t-work-consistently-across-machines">SSIS doesn&#39;t work consistently across machines</h3>
<p>The gist of the package we are building is that it takes an Excel spreadsheet, sanitizes the data, and upserts it into a database.</p>
<p>Some of the data was a little bit long. We built some columns to handle 512 characters in the database. Everything seemed like it was working fine.</p>
<p>But then one of the team members said it was failing for him, complaining about having to truncate data. We were all using the same spreadsheet, so this didn&#39;t make sense.</p>
<p>After some investigation, it turns out all of the columns coming from the spreadsheet were capped at 255 characters. That is strange in itself, but we&#39;ll get to that. But why was it not failing for me?</p>
<p>I still don&#39;t know the answer. Because everything in the package said that any value over 255 characters long should have been failing with an error. And that&#39;s what it was doing for my coworker - but not for me!</p>
<p>My bigger concern was this 255 character limit.</p>
<h3 id="ssis-and-excel-are-just-the-worst">SSIS and Excel are just the worst</h3>
<p>SSIS thinks it is soooo smart. It can predict the widths of your columns for you, so you don&#39;t have to define them! Hooray!</p>
<p>Except it only predicts the widths based on the first 8 rows of data. And if there is nothing very long in a column, it will set its max length to 255.</p>
<p>This wouldn&#39;t be the worst thing, if you could change the columns it got wrong. But you can&#39;t! You can try...but it will just blow away your changes when it re-samples the spreadsheet.</p>
<h4 id="but-you-can-change-the-default-sample-size-from-8-rows-to-something-else-">But you can change the default sample size from 8 rows to something else!</h4>
<p>Um...<a href="http://stackoverflow.com/a/8629065/1585069">in your registry</a>. That&#39;s a super fun way to make things fail differently for you than the rest of your team! And not a solution I plan on ever using.</p>
<h4 id="hey-didn-t-you-read-the-rest-of-that-answer-you-can-put-a-dummy-row-with-long-values-in-it-to-trick-ssis-">Hey, didn&#39;t you read the rest of that answer? You can put a dummy row with long values in it, to trick SSIS!</h4>
<p>Yup, you can. Then you have to alter your package to ignore it...and hope that no one accidentally deletes that row one day. This is the least bad option...but still bad.</p>
<p>One side-effect of adding the dummy row is that now every column that is more than 255 characters long goes from a <code>DT_WSTR(255)</code> type to a <code>DT_NTEXT</code> type. That makes sense.</p>
<h3 id="but-ssis-is-bad-at-determining-the-length-of-text">But SSIS is bad at determining the length of text</h3>
<p>For all of those columns that were fine as a <code>DT_WSTR(255)</code> type, the <code>LEN(x)</code> function is gravy.</p>
<p>But for all of those columns that became <code>DT_NTEXT</code>, SSIS will suddenly start doubling the column lengths. After the crazy pills wear off, you might find <a href="https://technet.microsoft.com/en-us/library/ms141797(v=sql.130">this</a>.aspx) -</p>
<blockquote>
<p>If the argument passed to the LEN function has a Binary Large Object Block (BLOB) data type, such as DT_TEXT, DT_NTEXT, or DT_IMAGE, the function returns a byte count.</p>
</blockquote>
<p>Ugh. I could see the argument for that with <code>DT_IMAGE</code>. But <code>DT_TEXT</code> and <code>DT_NTEXT</code>? They have &quot;text&quot; in the name! Why wouldn&#39;t I want the length of the text?</p>
<p>Turns out you have to do the conversion yourself. <code>LEN( (DT_WSTR, 600) X)</code> Thanks, SSIS!</p>
<h3 id="ssis-sucks-for-other-reasons-too">SSIS sucks for other reasons, too</h3>
<p>Deployment is bad. Our timebox ended before we could figure out if we could run this all off of a server.</p>
<p>It crashes often - at least with Visual Studio 2015. Especially when you pull latest on the repo and it has to reload the project.</p>
<p>When it crashes, it leaves a process running (SSIS Debug Host) that you have to kill before you can run it again.</p>
<h3 id="conclusion">Conclusion</h3>
<p>SSIS, consider me unimpressed.</p>
<p>My advice for someone who needs to import data from a spreadsheet:</p>
<ul>
<li>Build a command-line project.</li>
<li>Have that command-line project use SqlBulkCopy to move all excel rows into a working table in your database.</li>
<li>Have that command-line project then execute a bunch of T-SQL that does all your ETL things.</li>
<li>Hug yourself for avoiding SSIS.</li>
</ul>
</article><hr><div id="disqus_thread"><script>(function() {
    var d = document, s = d.createElement('script');
    s.src = '//pleepleus88githubio.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();</script></div><footer class="row"><hr><h6 class="pull-left">&copy; Steven J Hicks 2017.</h6><h6 class="pull-right">I built this site with<a href="http://www.metalsmith.io/">metalsmith.io.</a></h6></footer></div><script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script></body></html>